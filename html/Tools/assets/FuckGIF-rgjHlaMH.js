import{j as $,c as R,o as I,b as y,g as S,r as k,k as q,w as z}from"./index-A8J_1plS.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";var F={exports:{}},B=F.exports,j;function V(){return j||(j=1,function(b,L){(function(_,g){b.exports=g()})(B,function(){return function(_){function g(l){if(a[l])return a[l].exports;var f=a[l]={exports:{},id:l,loaded:!1};return _[l].call(f.exports,f,f.exports,g),f.loaded=!0,f.exports}var a={};return g.m=_,g.c=a,g.p="",g(0)}([function(_,g,a){var l,f,d=function(o,s){function c(){this.constructor=o}for(var p in s)w.call(s,p)&&(o[p]=s[p]);return c.prototype=s.prototype,o.prototype=new c,o.__super__=s.prototype,o},w={}.hasOwnProperty,i=[].indexOf||function(o){for(var s=0,c=this.length;s<c;s++)if(s in this&&this[s]===o)return s;return-1};l=a(1).EventEmitter,a(2),f=function(o){function s(e){var t,r,n;this.running=!1,this.options={},this.frames=[],this.groups=new Map,this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e);for(r in c)n=c[r],(t=this.options)[r]==null&&(t[r]=n)}var c,p;return d(s,o),c={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1},p={delay:500,copy:!1},s.prototype.setOption=function(e,t){if(this.options[e]=t,this._canvas!=null&&(e==="width"||e==="height"))return this._canvas[e]=t},s.prototype.setOptions=function(e){var t,r,n;r=[];for(t in e)w.call(e,t)&&(n=e[t],r.push(this.setOption(t,n)));return r},s.prototype.addFrame=function(e,t){var r,n,h;t==null&&(t={}),r={},r.transparent=this.options.transparent;for(h in p)r[h]=t[h]||p[h];if(this.options.width==null&&this.setOption("width",e.width),this.options.height==null&&this.setOption("height",e.height),typeof ImageData<"u"&&ImageData!==null&&e instanceof ImageData)r.data=e.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&e instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&e instanceof WebGLRenderingContext)t.copy?r.data=this.getContextData(e):r.context=e;else{if(e.childNodes==null)throw new Error("Invalid image");t.copy?r.data=this.getImageData(e):r.image=e}return n=this.frames.length,n>0&&r.data&&(this.groups.has(r.data)?this.groups.get(r.data).push(n):this.groups.set(r.data,[n])),this.frames.push(r)},s.prototype.render=function(){var e,t,r;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var n,h,u;for(u=[],n=0,h=this.frames.length;0<=h?n<h:n>h;0<=h?++n:--n)u.push(null);return u}).call(this),t=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(e=0,r=t;0<=r?e<r:e>r;0<=r?++e:--e)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},s.prototype.abort=function(){for(var e;e=this.activeWorkers.shift(),e!=null;)this.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},s.prototype.spawnWorkers=function(){var e,t,r;return e=Math.min(this.options.workers,this.frames.length),(function(){r=[];for(var n=t=this.freeWorkers.length;t<=e?n<e:n>e;t<=e?n++:n--)r.push(n);return r}).apply(this).forEach(function(n){return function(h){var u;return n.log("spawning worker "+h),u=new Worker(n.options.workerScript),u.onmessage=function(m){return n.activeWorkers.splice(n.activeWorkers.indexOf(u),1),n.freeWorkers.push(u),n.frameFinished(m.data,!1)},n.freeWorkers.push(u)}}(this)),e},s.prototype.frameFinished=function(e,t){var r,n,h,u;if(this.finishedFrames++,t?(r=this.frames.indexOf(e),n=this.groups.get(e.data)[0],this.log("frame "+(r+1)+" is duplicate of "+n+" - "+this.activeWorkers.length+" active"),this.imageParts[r]={indexOfFirstInGroup:n}):(this.log("frame "+(e.index+1)+" finished - "+this.activeWorkers.length+" active"),this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e),this.options.globalPalette===!0&&!t&&(this.options.globalPalette=e.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(h=1,u=this.freeWorkers.length;1<=u?h<u:h>u;1<=u?++h:--h)this.renderNextFrame();return i.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},s.prototype.finishRendering=function(){var e,t,r,n,h,u,m,v,x,D,U,M,N,P,C,A,E,W,G,O;for(E=this.imageParts,h=u=0,D=E.length;u<D;h=++u)t=E[h],t.indexOfFirstInGroup&&(this.imageParts[h]=this.imageParts[t.indexOfFirstInGroup]);for(x=0,W=this.imageParts,m=0,U=W.length;m<U;m++)t=W[m],x+=(t.data.length-1)*t.pageSize+t.cursor;for(x+=t.pageSize-t.cursor,this.log("rendering finished - filesize "+Math.round(x/1e3)+"kb"),e=new Uint8Array(x),C=0,G=this.imageParts,v=0,M=G.length;v<M;v++)for(t=G[v],O=t.data,r=P=0,N=O.length;P<N;r=++P)A=O[r],e.set(A,C),C+=r===t.data.length-1?t.cursor:t.pageSize;return n=new Blob([e],{type:"image/gif"}),this.emit("finished",n,e)},s.prototype.renderNextFrame=function(){var e,t,r,n;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return e=this.frames[this.nextFrame++],t=this.frames.indexOf(e),t>0&&this.groups.has(e.data)&&this.groups.get(e.data)[0]!==t?void setTimeout(function(h){return function(){return h.frameFinished(e,!0)}}(this),0):(n=this.freeWorkers.shift(),r=this.getTask(e),this.log("starting frame "+(r.index+1)+" of "+this.frames.length),this.activeWorkers.push(n),n.postMessage(r))},s.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},s.prototype.getImageData=function(e){var t;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),t=this._canvas.getContext("2d"),t.setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},s.prototype.getTask=function(e){var t,r;if(t=this.frames.indexOf(e),r={index:t,last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:!0},e.data!=null)r.data=e.data;else if(e.context!=null)r.data=this.getContextData(e.context);else{if(e.image==null)throw new Error("Invalid frame");r.data=this.getImageData(e.image)}return r},s.prototype.log=function(e){if(this.options.debug)return console.log(e)},s}(l),_.exports=f},function(_,g){function a(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(i){return typeof i=="function"}function f(i){return typeof i=="number"}function d(i){return typeof i=="object"&&i!==null}function w(i){return i===void 0}_.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.prototype.setMaxListeners=function(i){if(!f(i)||i<0||isNaN(i))throw TypeError("n must be a positive number");return this._maxListeners=i,this},a.prototype.emit=function(i){var o,s,c,p,e,t;if(this._events||(this._events={}),i==="error"&&(!this._events.error||d(this._events.error)&&!this._events.error.length)){if(o=arguments[1],o instanceof Error)throw o;var r=new Error('Uncaught, unspecified "error" event. ('+o+")");throw r.context=o,r}if(s=this._events[i],w(s))return!1;if(l(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:p=Array.prototype.slice.call(arguments,1),s.apply(this,p)}else if(d(s))for(p=Array.prototype.slice.call(arguments,1),t=s.slice(),c=t.length,e=0;e<c;e++)t[e].apply(this,p);return!0},a.prototype.addListener=function(i,o){var s;if(!l(o))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",i,l(o.listener)?o.listener:o),this._events[i]?d(this._events[i])?this._events[i].push(o):this._events[i]=[this._events[i],o]:this._events[i]=o,d(this._events[i])&&!this._events[i].warned&&(s=w(this._maxListeners)?a.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[i].length>s&&(this._events[i].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[i].length),typeof console.trace=="function"&&console.trace())),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(i,o){function s(){this.removeListener(i,s),c||(c=!0,o.apply(this,arguments))}if(!l(o))throw TypeError("listener must be a function");var c=!1;return s.listener=o,this.on(i,s),this},a.prototype.removeListener=function(i,o){var s,c,p,e;if(!l(o))throw TypeError("listener must be a function");if(!this._events||!this._events[i])return this;if(s=this._events[i],p=s.length,c=-1,s===o||l(s.listener)&&s.listener===o)delete this._events[i],this._events.removeListener&&this.emit("removeListener",i,o);else if(d(s)){for(e=p;e-- >0;)if(s[e]===o||s[e].listener&&s[e].listener===o){c=e;break}if(c<0)return this;s.length===1?(s.length=0,delete this._events[i]):s.splice(c,1),this._events.removeListener&&this.emit("removeListener",i,o)}return this},a.prototype.removeAllListeners=function(i){var o,s;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[i]&&delete this._events[i],this;if(arguments.length===0){for(o in this._events)o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[i],l(s))this.removeListener(i,s);else if(s)for(;s.length;)this.removeListener(i,s[s.length-1]);return delete this._events[i],this},a.prototype.listeners=function(i){return this._events&&this._events[i]?l(this._events[i])?[this._events[i]]:this._events[i].slice():[]},a.prototype.listenerCount=function(i){if(this._events){var o=this._events[i];if(l(o))return 1;if(o)return o.length}return 0},a.listenerCount=function(i,o){return i.listenerCount(o)}},function(_,g){var a,l,f,d,w;w=navigator.userAgent.toLowerCase(),d=navigator.platform.toLowerCase(),a=w.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],f=a[1]==="ie"&&document.documentMode,l={name:a[1]==="version"?a[3]:a[1],version:f||parseFloat(a[1]==="opera"&&a[4]?a[4]:a[2]),platform:{name:w.match(/ip(?:ad|od|hone)/)?"ios":(w.match(/(?:webos|android)/)||d.match(/mac|win|linux/)||["other"])[0]}},l[l.name]=!0,l[l.name+parseInt(l.version,10)]=!0,l.platform[l.platform.name]=!0,_.exports=l}])})}(F)),F.exports}var H=V();const J=$(H),K={},Q={class:"box"},X={class:"main"};function Y(b,L){return I(),R("div",Q,[y("div",X,[S(b.$slots,"default",{},void 0,!0)])])}const Z=T(K,[["render",Y],["__scopeId","data-v-8ec0e034"]]),ee={class:"index"},te={class:"content"},re={key:0},se=["src"],ne={key:1},ie="../../assets/img/bc1.png",oe="../../assets/img/bc2.png",ae="../../assets/img/bc3.png",he={__name:"FuckGIF",setup(b){const L=k(""),_=k("up_ac"),g=async e=>{try{const t=new Image;return t.src=e,await new Promise((r,n)=>{t.onload=r,t.onerror=h=>{console.error("图片加载失败:",h),n(h)}}),t}catch(t){console.error("获取图片失败:",t)}},a=k([]);(async()=>{try{a.value=await Promise.all([g(ie),g(oe),g(ae)])}catch(e){console.error("加载图片失败:",e)}})();const f=k([]);let d=!1;const w=e=>new Promise((t,r)=>{const n=new Image;n.crossOrigin="Anonymous",n.src=e,n.onload=()=>t(n),n.onerror=h=>r(`Error loading image: ${h}`)}),i=async e=>{f.value=[];const t=e.target.files[0];if(!t||!t.type.startsWith("image/")||d)return alert("请选择一张图片或正在处理，请稍候");d=!0,L.value=URL.createObjectURL(t),console.log("开始加载图片");try{const r=await w(L.value);console.log("图片加载完成");const n=await Promise.all([o(a.value[0],r,5,160),o(a.value[1],r,5,165),o(a.value[2],r,0,175)]);f.value.push(...n),console.log(f.value.length),await p()}catch(r){console.error("图片加载或合成失败:",r)}finally{d=!1}},o=(e,t,r,n)=>new Promise((h,u)=>{const m=document.createElement("canvas"),v=m.getContext("2d");m.width=e.width,m.height=e.height,v.drawImage(e,0,0),v.beginPath(),v.arc(r+60,n+60,60,0,Math.PI*2),v.closePath(),v.clip(),v.translate(r+60,n+60),v.rotate(-Math.PI/2),v.drawImage(t,-60,-60,120,120);const x=m.toDataURL();h(x)}),s=async e=>new Promise((t,r)=>{const n=new J({quality:10,workers:4,workerScript:"/assets/gif.worker.js",width:300,height:300,optimize:!0});e.forEach(h=>{n.addFrame(h,{delay:20})}),n.on("finished",h=>{const u=URL.createObjectURL(h);console.log("生成的 GIF URL:",u),t(u)}),n.on("error",h=>{r("生成 GIF 时出错: "+h)}),n.render()}),c=k(""),p=async()=>{try{const e=await Promise.all(f.value.map(r=>new Promise((n,h)=>{const u=new Image;u.src=r,u.onload=()=>n(u),u.onerror=m=>h("图片加载失败: "+m)}))),t=await s(e);console.log("GIF URL: ",t),c.value=t}catch(e){console.error("生成 GIF 失败: ",e)}};return(e,t)=>(I(),q(Z,null,{default:z(()=>[y("div",ee,[t[2]||(t[2]=y("h1",{class:"title"},"艾草GIF生成器",-1)),y("div",te,[y("input",{ref_key:"up_ac",ref:_,style:{display:"none"},type:"file",onChange:i},null,544),y("div",{class:"upload_ac",onClick:t[0]||(t[0]=r=>_.value.click())},"上传艾草头像"),c.value?(I(),R("div",re,[y("img",{src:c.value,alt:"Generated GIF",width:"200"},null,8,se)])):(I(),R("div",ne,t[1]||(t[1]=[y("p",null,"未上传图片 或 正在生成 GIF...",-1)])))])])]),_:1}))}},ce=T(he,[["__scopeId","data-v-330e0d54"]]);export{ce as default};
